#!/bin/bash

# Function to process a single directory
process_directory() {
    local dir="$1"
    shopt -s nullglob
    log_files=("$dir"/*.log)

    for logfile in "${log_files[@]}"; do
        found_any=false

        error_matches=$(grep -i error "$logfile")
        fail_matches=$(grep -i fail "$logfile")

        if [[ -n "$error_matches" || -n "$fail_matches" ]]; then
            echo "In directory: $dir"
            echo "  Log file: $logfile"

            if [[ -n "$error_matches" ]]; then
                echo "    Matches for 'error':"
                echo "$error_matches"
            fi

            if [[ -n "$fail_matches" ]]; then
                echo "    Matches for 'fail':"
                echo "$fail_matches"
            fi

            echo
        fi
    done
}

# Find all directories and process each
find . -type d | while read -r subdir; do
    process_directory "$subdir"
done