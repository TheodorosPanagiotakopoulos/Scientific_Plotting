#!/bin/bash

# Highlight key phrases:
# - Red: "no such file or directory", "does not exist", "doesn't exist"
# - Magenta: "memory"
highlight_special_phrases() {
    sed -E "
        s/(no such file or directory)/$(printf '\033[1;31m')\1$(printf '\033[0m')/Ig;
        s/(does not exist)/$(printf '\033[1;31m')\1$(printf '\033[0m')/Ig;
        s/(doesn[’']t exist)/$(printf '\033[1;31m')\1$(printf '\033[0m')/Ig;
        s/(memory)/$(printf '\033[1;35m')\1$(printf '\033[0m')/Ig
    "
}

# Process a single directory
process_directory() {
    local dir="$1"
    shopt -s nullglob
    log_files=("$dir"/*.log)

    for logfile in "${log_files[@]}"; do  
        error_tmp=$(mktemp)
        fail_tmp=$(mktemp)

        # Match 'error' not followed by ';'
        awk '{IGNORECASE=1} /error/ && $0 !~ /error *;/ {print}' "$logfile" > "$error_tmp"
        
        # Match 'fail'
        grep -i 'fail' "$logfile" > "$fail_tmp"  

        if [[ -s "$error_tmp" || -s "$fail_tmp" ]]; then  
            echo "In directory: $dir"  
            echo "  Log file: $logfile"  

            if [[ -s "$error_tmp" ]]; then  
                echo "    Matches for 'error':"  
                GREP_COLOR='1;32' grep --color=always -i 'error' "$error_tmp" | highlight_special_phrases
            fi  

            if [[ -s "$fail_tmp" ]]; then  
                echo "    Matches for 'fail':"  
                GREP_COLOR='1;33' grep --color=always -i 'fail' "$fail_tmp" | highlight_special_phrases
            fi  

            echo  
        fi  

        rm -f "$error_tmp" "$fail_tmp"  
    done
}

# Recursively process all directories
while IFS= read -r -d '' subdir; do
    process_directory "$subdir"
done < <(find . -type d -print0)

exit



The Newron job with RC3 did not complete. The data_prep_low_order_10 step finished, but the job stopped before moving to training_low_order_20. I’m investigating the issue.

The CRMS file for training_low_order_20 had a path specified, while for data_prep_low_order_10, the path was left blank, likely triggering a default. Would you suggest I try removing the path to see if it works?

Should I retry with RC3 or a different version, or wait until Monday to review it with you?

Also, the new RC version hasn’t been released yet.