#!/bin/bash

# Function to add yellow highlighting to specific words in a line
highlight_yellow() {
    sed -E 's/(no such file or directory|memory)/\x1b[1;33m\1\x1b[0m/Ig'
}

# Function to process a single directory
process_directory() {
    local dir="$1"
    shopt -s nullglob
    log_files=("$dir"/*.log)

    for logfile in "${log_files[@]}"; do
        # Search for 'error'
        grep -i 'error' "$logfile" | sed 's/^/\x1b[1;32m/' | highlight_yellow > /tmp/grep_error.tmp
        # Search for 'fail'
        grep -i 'fail' "$logfile" | sed 's/^/\x1b[1;33m/' | highlight_yellow > /tmp/grep_fail.tmp

        if [[ -s /tmp/grep_error.tmp || -s /tmp/grep_fail.tmp ]]; then
            echo "In directory: $dir"
            echo "  Log file: $logfile"

            if [[ -s /tmp/grep_error.tmp ]]; then
                echo "    Matches for 'error':"
                cat /tmp/grep_error.tmp
            fi

            if [[ -s /tmp/grep_fail.tmp ]]; then
                echo "    Matches for 'fail':"
                cat /tmp/grep_fail.tmp
            fi

            echo
        fi

        rm -f /tmp/grep_error.tmp /tmp/grep_fail.tmp
    done
}

# Process all directories recursively
find . -type d | while read -r subdir; do
    process_directory "$subdir"
done